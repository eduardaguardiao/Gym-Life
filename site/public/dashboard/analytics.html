<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Análise</title>
  <script src="https://kit.fontawesome.com/ce9ef0d266.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="website icon" href="../assets/logoSimbolo.png">
  <link rel="stylesheet" href="../css/analytics.css">
</head>

<body onload="qtdPessoas()"> 

  <div class="header">
    <img src="../assets/logoSemfundo.png">
    <div class="sair">
      <a href="../quiz.html"><i class="fa-solid fa-user" style="color: #b23a48; font-size: 28px;"></i></a>
      <a href="../login.html"><i class="fa-solid fa-right-from-bracket"
          style="color: #b23a48; font-size: 28px; padding: 20px;"></i></a>
    </div>
  </div>

  

  <div class="dash" id="dash">
    <h2>Análise de Desempenho</h2>
    <canvas id="myChart1"></canvas>
  </div>

  <!-- fomulario -->

  <div class="form" id="form">
    <div class="left-column">
      <h1>Caixa de Sugestões</h1>
      <b>
        <span>Suas ideias são importantes para nós! <br> Compartilhe suas sugestões e nos ajude a criar uma experiência
          ainda melhor para você.</span>
      </b>
    </div>
    <div class="right-column">
      <form>
        <!-- <p>Sugestão:</p><br> -->
        <textarea id="text_sugestao" name="sugestao" rows="4" cols="30" maxlength="200"
          placeholder="Insira sua sugestão aqui!"></textarea><br>
        <div class="button-container">
          <button id="buttonSubmit" onclick="enviar()">Enviar</button>
          <p id="mensagem" style="display: none;">Obrigado!</p>
        </div>
      </form>
    </div>
  </div>

  <!-- footer -->
  <footer>
    <div class="footer">
      <ul>
        <div class="redesSociais">
          <a href="https://github.com/eduardaguardiao">
            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="40" height="40" viewBox="0,0,256,256">
              <g fill="#b23a48" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt"
                stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0"
                font-family="none" font-weight="none" font-size="none" text-anchor="none"
                style="mix-blend-mode: normal">
                <g transform="scale(10.66667,10.66667)">
                  <path
                    d="M10.9,2.1c-4.6,0.5 -8.3,4.2 -8.8,8.7c-0.5,4.7 2.2,8.9 6.3,10.5c0.3,0.1 0.6,-0.1 0.6,-0.5v-1.6c0,0 -0.4,0.1 -0.9,0.1c-1.4,0 -2,-1.2 -2.1,-1.9c-0.1,-0.4 -0.3,-0.7 -0.6,-1c-0.3,-0.1 -0.4,-0.1 -0.4,-0.2c0,-0.2 0.3,-0.2 0.4,-0.2c0.6,0 1.1,0.7 1.3,1c0.5,0.8 1.1,1 1.4,1c0.4,0 0.7,-0.1 0.9,-0.2c0.1,-0.7 0.4,-1.4 1,-1.8c-2.3,-0.5 -4,-1.8 -4,-4c0,-1.1 0.5,-2.2 1.2,-3c-0.1,-0.2 -0.2,-0.7 -0.2,-1.4c0,-0.4 0,-0.9 0.2,-1.3c0,-0.2 0.2,-0.3 0.3,-0.3h0.1c0.5,0.1 1.5,0.4 2.4,1.3c0.6,-0.2 1.3,-0.3 2,-0.3c0.7,0 1.4,0.1 2,0.3c0.9,-0.9 2,-1.2 2.5,-1.3h0.1c0.2,0 0.3,0.1 0.4,0.3c0,0.4 0,0.9 0,1.3c0,0.8 -0.1,1.2 -0.2,1.4c0.7,0.8 1.2,1.8 1.2,3c0,2.2 -1.7,3.5 -4,4c0.6,0.5 1,1.4 1,2.3v2.6c0,0.3 0.3,0.6 0.7,0.5c3.7,-1.5 6.3,-5.1 6.3,-9.3c0,-6 -5.1,-10.7 -11.1,-10z">
                    <a href="GymLife.html">Home</a></path><a href="GymLife.html">Home</a>
                </g><a href="GymLife.html">Home</a>
              </g>
            </svg>
          </a>
          <a href="https://instagram.com/eduardaguardiao?igshid=OGQ5ZDc2ODk2ZA==">
            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="40" height="40" viewBox="0,0,256,256">
              <g fill="#b23a48" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt"
                stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0"
                font-family="none" font-weight="none" font-size="none" text-anchor="none"
                style="mix-blend-mode: normal">
                <g transform="scale(5.12,5.12)">
                  <path
                    d="M16,3c-7.17,0 -13,5.83 -13,13v18c0,7.17 5.83,13 13,13h18c7.17,0 13,-5.83 13,-13v-18c0,-7.17 -5.83,-13 -13,-13zM37,11c1.1,0 2,0.9 2,2c0,1.1 -0.9,2 -2,2c-1.1,0 -2,-0.9 -2,-2c0,-1.1 0.9,-2 2,-2zM25,14c6.07,0 11,4.93 11,11c0,6.07 -4.93,11 -11,11c-6.07,0 -11,-4.93 -11,-11c0,-6.07 4.93,-11 11,-11zM25,16c-4.96,0 -9,4.04 -9,9c0,4.96 4.04,9 9,9c4.96,0 9,-4.04 9,-9c0,-4.96 -4.04,-9 -9,-9z">
                    <a href="GymLife.html">Home</a></path><a href="GymLife.html">Home</a>
                </g><a href="GymLife.html">Home</a>
              </g>
            </svg>
          </a>

          <a
            href="https://www.linkedin.com/in/maria-eduarda-504761286?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app">
            <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="40" height="40" viewBox="0,0,256,256">
              <g fill="#b23a48" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt"
                stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0"
                font-family="none" font-weight="none" font-size="none" text-anchor="none"
                style="mix-blend-mode: normal">
                <g transform="scale(5.12,5.12)">
                  <path
                    d="M41,4h-32c-2.76,0 -5,2.24 -5,5v32c0,2.76 2.24,5 5,5h32c2.76,0 5,-2.24 5,-5v-32c0,-2.76 -2.24,-5 -5,-5zM17,20v19h-6v-19zM11,14.47c0,-1.4 1.2,-2.47 3,-2.47c1.8,0 2.93,1.07 3,2.47c0,1.4 -1.12,2.53 -3,2.53c-1.8,0 -3,-1.13 -3,-2.53zM39,39h-6c0,0 0,-9.26 0,-10c0,-2 -1,-4 -3.5,-4.04h-0.08c-2.42,0 -3.42,2.06 -3.42,4.04c0,0.91 0,10 0,10h-6v-19h6v2.56c0,0 1.93,-2.56 5.81,-2.56c3.97,0 7.19,2.73 7.19,8.26z">
                    <a href="GymLife.html">Home</a></path><a href="GymLife.html">Home</a>
                </g><a href="GymLife.html">Home</a>
              </g>
            </svg>
          </a>
        </div>
      </ul>
      <p>
        © 2023 | Site by @eduardaguardiao
      </p>
    </div>
  </footer>

 
</body>

</html>
<script>

function qtdPessoas() {
        fetch(`/analytics/exibirTotalPessoas`, { cache: 'no-store' }).then(function (response) {
      response.json().then(function (resposta) {
        console.log(`Dados obtidos: ${JSON.stringify(resposta)}`);

        construirGraficoPessoas(resposta)
      });

    })
    }

function construirGraficoPessoas(resposta) {

console.log('iniciando plotagem do gráfico...');

// Criando estrutura para plotar gráfico - labels
let labels = [];

// Criando estrutura para plotar gráfico - dados
let dados = {
    labels: labels,
    datasets: [{
        label: 'quantidade de pessoas por acertos',
        data: [],
        backgroundColor: '#b23a48',
        hoverBackgroundColor: '#8c2f39',
        font: 'bold',
        fill: false,
        tension: 0.1
    },
    
    ]
};

console.log('----------------------------------------------')
console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
console.log(resposta)

// Inserindo valores recebidos em estrutura para plotar o gráfico

for (i = 0; i < resposta.length; i++) {
    var registro = resposta[i];
    if (registro.pontuacao === 1) {
        labels.push(registro.pontuacao + ' acerto');
    } else {
        labels.push(registro.pontuacao + ' acertos');
    }
    dados.datasets[0].data.push(registro.quantidade);
}


console.log('----------------------------------------------')
console.log('O gráfico será plotado com os respectivos valores:')
console.log('Labels:')
console.log(labels)
console.log('Dados:')
console.log(dados.datasets)
console.log('----------------------------------------------')

// Criando estrutura para plotar gráfico - config
const config = {
  type: 'bar',
  data: dados,
  options: {
    plugins: {
      title: { 
        text: ''
      },
      legend: {
        display: false,
        position: 'top',
        labels: {
          font: {
            size: 15,
            family: 'Times New Roman, Times, serif'
          },
          color: '#000'
        }
      }
    },
    scales: {
      y: {
        beginAtZero: true,
        ticks: {
          stepSize: 1 
        }
      }
    }
  }
};


// Adicionando gráfico criado em div na tela
let myChart = new Chart(
    document.getElementById(`myChart1`),
    config
);

}

  // FORMULARIO

  function enviar() {

    var idVar = sessionStorage.ID_USUARIO;
    var sugestaoVar = text_sugestao.value

    fetch("/formulario/enviar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        idServer: idVar,
        sugestaoServer: sugestaoVar
      })
    }).then(function (resposta) {
      console.log("resposta: ", resposta);

      if (resposta.ok) {

        limparFormulario();

      } else {

      }
    })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });

    return false;
  }


  document.getElementById("form").addEventListener("submit", function (event) {
    event.preventDefault();

    setTimeout(function () {

      document.getElementById("buttonSubmit").style.display = "none";
      document.getElementById("text_sugestao").style.display = "none";
      document.getElementById("mensagem").style.display = "block";
    },);
  });



</script>